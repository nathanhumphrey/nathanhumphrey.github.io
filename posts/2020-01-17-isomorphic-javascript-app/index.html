<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-50453547-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-50453547-1');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isomorphic JavaScript App</title>
    <meta name="Description" content="A walkthrough build of a simple isomorphic JavaScript application, built using Koa and React.">
    <link rel="icon" type="image/png" href="/favicon.ico?2108987463f3bdd37020efde9541db90">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/index.css?c9e5ee1b6044eb4d4944caa3dd4a9a">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Nathan Humphrey">
  </head>
  <body>
    <div class="container" id="top">
      <header class="page-header">
        <p class="home">
          <a href="/">nh</a>
        </p>
        <nav class="page-nav">
          <h2 class="visually-hidden">Main Navigation Menu</h2>
          <ul class="nav"><li class="nav-item"><a href="/">Home</a></li>
<li class="nav-item"><a href="/posts/">Blog</a></li>
<li class="nav-item"><a href="/about/">About</a></li></ul>
        </nav>
      </header>

      <main class="tmpl-post" >
        <h1>Isomorphic JavaScript App</h1>
<p class="meta time"><time datetime="2020-01-17T07:00:00.000Z">Friday, January 17, 2020</time></p>
<p class="meta author">by Nathan Humphrey</p>
<p class="meta tags">

    <a href="/tags/software/" class="tag">software</a>
    <a href="/tags/tutorial/" class="tag">tutorial</a>
    <a href="/tags/isomorphic/" class="tag">isomorphic</a>
    <a href="/tags/ssr/" class="tag">ssr</a>
    <a href="/tags/react/" class="tag">react</a>
    <a href="/tags/koa/" class="tag">koa</a>
</p>
<h2 id="but-why%3F">But why? <a class="direct-link" href="#but-why%3F">#</a></h2>
<p>So, the other day, I had this great idea to explore the land of <a href="https://en.wikipedia.org/wiki/Isomorphic_JavaScript">isomorphic</a> JavaScript and server-side rendering (SSR), because why not? Building front-end applications that run entirely on the client is fun, but sometimes you need to execute some custom business logic or work with a secret key that you don't want to be exposed on the client. For me, the goto choice for the front-end part of this project will be React (sorry Vue fans, but I haven't been converted ... yet), and you might think that Express would be my go-to for the server, but I've been working with Koa for some time now so that's what I've chosen as my backend for this project.</p>
<p>Alright, what will it take to pull this off?</p>
<h2 id="requirements">Requirements <a class="direct-link" href="#requirements">#</a></h2>
<ul>
<li>Backend server - required for server-side rendering of course</li>
<li>Front-end library that supports SSR - code sharing between client and server (could be vanilla JS, but React works nicely here)</li>
<li>Application bundler - work with ES6+ features and, in this case, JSX</li>
</ul>
<p>As this post is about isomorphic development with JavaScript, I'm not going to go into the details of the libraries/frameworks I've chosen to use in the implementation. If you'd like to learn more about them, there are many articles and courses online that can help. I've created a GitHub repo with the finished project that you can check out as well.</p>
<p><em><strong>You can find the project repository <a href="https://github.com/nathanhumphrey/simple-isomorphic-app">here</a>.</strong></em></p>
<h3 id="node.js-%2B-koa">Node.js + Koa <a class="direct-link" href="#node.js-%2B-koa">#</a></h3>
<p>Some of you may be thinking, &quot;<a href="https://koajs.com/">Koa</a>? Never heard of it, why not use Express?&quot; and you're right, you could use Express but I prefer the <a href="https://github.com/koajs/koa/blob/master/docs/koa-vs-express.md">&quot;simplicity&quot; and configuration-over-convention</a> of Koa. Everything I'm about to show you, using Koa, you could easily implement in Express, so this isn't that big an issue.</p>
<h3 id="react">React <a class="direct-link" href="#react">#</a></h3>
<p>These days, it seems like everything is built in <a href="https://reactjs.org/">React</a>; there are some promising up-and-comers, but React is still the dominant front-end library. Of course, using a front-end library is not a strict requirement, building an isomorphic app could be done via vanilla JS, but React is fairly ubiquitous and supports <a href="https://reactjs.org/docs/react-dom-server.html">SSR</a>, so that should save us some time.</p>
<h3 id="webpack">Webpack <a class="direct-link" href="#webpack">#</a></h3>
<p>For bundling, I'm still sticking with <a href="https://webpack.js.org/">webpack</a>. You could ask &quot;why use a bundler at all?&quot;, and I'd respond, &quot;because we need to <a href="http://tinselcity.net/whys/packers">bundle all the things</a>... right?&quot; Seriously though, we need some way to transpile and bundle the application for deployment, so I've chosen to go with what I know here too. As stated above regarding Koa vs. Express, you could probably get this to work with another bundler (or perhaps just straight Babel), but webpack makes it so much easier for me.</p>
<h2 id="initial-setup">Initial setup <a class="direct-link" href="#initial-setup">#</a></h2>
<p>First things first, we need a directory setup. For an isomorphic application, we'll need to have some code that executes on the client, some code that executes on the server, and some code that is shared between the two (essentially the application itself). So, with that in mind, let's set up our directory structure like so:</p>
<p class="info">
NOTE: the following directory structure is one that makes sense to me. You may see similar setups where the 'app' directory is named 'shared' or something else. Choose names that make sense to you.  
</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">project/</span><br><span class="highlight-line">    <span class="token operator">|</span>-src/</span><br><span class="highlight-line">        <span class="token operator">|</span>-client/</span><br><span class="highlight-line">        <span class="token operator">|</span>-server/</span><br><span class="highlight-line">        <span class="token operator">|</span>-app/</span></code></pre>
<p class="caption">project directory structure</p>
<p>This initial directory structure may require some modification once we get started, but these directories are pretty much must-haves. All development code will be stored in the <code>src/</code> directory; specifically, the Koa server will be stored in <code>server/</code>, the client loader will be stored in <code>client/</code>, and the React application will be stored in <code>app/</code>.</p>
<h3 id="install-the-requirements">Install the requirements <a class="direct-link" href="#install-the-requirements">#</a></h3>
<p>From within your terminal, navigate to your <code>project/</code> directory, initialize your project with npm, and then install the required base packages:</p>
<pre class="language-bash"><code class="language-bash"><span class="highlight-line">$ <span class="token function">npm</span> init -y</span><br><span class="highlight-line">$ <span class="token function">npm</span> i @babel/core @babel/preset-env @babel/preset-react <span class="token punctuation">\</span></span><br><span class="highlight-line">react react-dom koa @babel/cli koa-webpack webpack webpack-cli <span class="token punctuation">\</span></span><br><span class="highlight-line">babel-loader</span></code></pre>
<p class="caption">npm init and install commands</p>
<h2 id="complete-the-build">Complete the build <a class="direct-link" href="#complete-the-build">#</a></h2>
<h3 id="create-the-application">Create the application <a class="direct-link" href="#create-the-application">#</a></h3>
<p>Create an <code>App.js</code> file in the <code>src/app/</code> directory and add the following code:</p>
<p class="info">
NOTE: I've chosen to have this sample app implement a simple click interaction (as seen <a href="https://reactjs.org/docs/hooks-state.html">elsewhere</a>). Again here, choose whatever interaction you'd like if you want something more meaningful. I just wanted something easy to implement that would allow for testing code execution on the client.
</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React<span class="token punctuation">,</span> <span class="token punctuation">{</span> useState <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> <span class="token punctuation">[</span>clicks<span class="token punctuation">,</span> setClicks<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">useState</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>div<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>h1<span class="token operator">></span>React Clicker Application<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>button onClick<span class="token operator">=</span><span class="token punctuation">{</span><span class="token parameter">e</span> <span class="token operator">=></span> <span class="token function">setClicks</span><span class="token punctuation">(</span>clicks <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token operator">></span></span><br><span class="highlight-line">        Clicked <span class="token punctuation">{</span>clicks<span class="token punctuation">}</span> times</span><br><span class="highlight-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span></code></pre>
<p class="caption">basic React component with simple state management</p>
<p>The simple component created above will allow us to demonstrate that the app can be rendered server-side, but also provide interaction once on the client.</p>
<h3 id="create-the-server">Create the server <a class="direct-link" href="#create-the-server">#</a></h3>
<p>Create an <code>index.js</code> file in the <code>src/server/</code> directory and add the following code:</p>
<p class="info">
NOTE: I wouldn't use the following implementation in production; meaning, I wouldn't want my application sever running everything through webpack for every request. Preparing an isomorphic applicaiton for production may be covered in another post.
</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> Koa <span class="token keyword">from</span> <span class="token string">"koa"</span><span class="token punctuation">;</span> <span class="token comment">// base server</span></span><br><span class="highlight-line"><span class="token keyword">import</span> koaWebpack <span class="token keyword">from</span> <span class="token string">"koa-webpack"</span><span class="token punctuation">;</span> <span class="token comment">// useful for development</span></span><br><span class="highlight-line"><span class="token keyword">import</span> webpack <span class="token keyword">from</span> <span class="token string">"webpack"</span><span class="token punctuation">;</span> <span class="token comment">// to bundle in development</span></span><br><span class="highlight-line"><span class="token keyword">import</span> config <span class="token keyword">from</span> <span class="token string">"../../webpack.config"</span><span class="token punctuation">;</span> <span class="token comment">// import webpack config</span></span><br><span class="highlight-line"><span class="token keyword">import</span> renderReactApp <span class="token keyword">from</span> <span class="token string">"./render-react-app"</span><span class="token punctuation">;</span> <span class="token comment">// performs the SSR</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create the app server</span></span><br><span class="highlight-line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// prepare webpack compiler</span></span><br><span class="highlight-line"><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create koa webpack middleware</span></span><br><span class="highlight-line"><span class="token function">koaWebpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span> compiler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">middleware</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// use the koa middleware</span></span><br><span class="highlight-line">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token comment">// use renderReactApp middleware (not yet implemented)</span></span><br><span class="highlight-line">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>renderReactApp<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// just listen on port 3000, for now</span></span><br><span class="highlight-line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"Server listening on port 3000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">super simple koa server, only supports SSR React app</p>
<p>What the previous code does is this:</p>
<ul>
<li>creates a new Koa app server</li>
<li>utilize koa-webpack to build webpack middleware</li>
<li>render the application (not yet implemented)</li>
<li>listen for connections on port 3000</li>
</ul>
<p>Based on this simple implementation, we need to create two things: a <strong>webpack config</strong> and a <strong>renderReactApp</strong> middleware.</p>
<h4 id="webpack.config.js">webpack.config.js <a class="direct-link" href="#webpack.config.js">#</a></h4>
<p>The purpose of using webpack on this build is to bundle the project code that will be required for the client (entry will be in the <code>src/client/</code> directory. For now, all we need to do is run our client code through babel and output the bundle to a simple-named file. Create the <code>webpack.config.js</code> file in the <code>projet/</code> root directory and add the following code:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"path"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  mode<span class="token operator">:</span> <span class="token string">"development"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  target<span class="token operator">:</span> <span class="token string">"web"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"./src/client/index.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  resolve<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"*"</span><span class="token punctuation">,</span> <span class="token string">".js"</span><span class="token punctuation">,</span> <span class="token string">".jsx"</span><span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  output<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"static"</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    publicPath<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    filename<span class="token operator">:</span> <span class="token string">"index.js"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  module<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    rules<span class="token operator">:</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">      <span class="token punctuation">{</span></span><br><span class="highlight-line">        test<span class="token operator">:</span> <span class="token regex">/\.(m?js|jsx)$/</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        exclude<span class="token operator">:</span> <span class="token regex">/node_modules/</span><span class="token punctuation">,</span></span><br><span class="highlight-line">        use<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">          loader<span class="token operator">:</span> <span class="token string">"babel-loader"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">          options<span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">            presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token string">"@babel/preset-react"</span><span class="token punctuation">]</span></span><br><span class="highlight-line">          <span class="token punctuation">}</span></span><br><span class="highlight-line">        <span class="token punctuation">}</span></span><br><span class="highlight-line">      <span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token punctuation">]</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">webpack.config.js to create our application bundle</p>
<p class="info">
NOTE: I've used CJS module syntax for this file, which is due to it's being executed outside of any Babel pipeline; soon we should be able to use ES Modules everywhere.
</p>
<h4 id="renderreactapp.js">renderReactApp.js <a class="direct-link" href="#renderreactapp.js">#</a></h4>
<p>Create a <code>render-react-app.js</code> file in the <code>src/server/</code> directory and add the following code:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-dom/server"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"../app/App"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token parameter">ctx</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> renderComponent <span class="token operator">=</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>html<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>head<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>title<span class="token operator">></span>Isomorphic React App<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"index.js"</span> defer <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>body<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span></span><br><span class="highlight-line">          <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>renderComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">code for SSR of the React component we created earlier</p>
<p>The <code>render-react-app.js</code> file doesn't do anything fancy, it simply creates a Koa middleware that can render our App component within a div; it also includes a <code>script</code> element that will be used to deliver the client payload for app hydration (see <a href="#webpack.config.js">webpack.config.js</a> above). The middleware will call the <code>renderToString()</code> function from the <code>react-dom/server</code> package, which provides the magic of SSR in this case.</p>
<h3 id="create-the-client-side-code">Create the client-side code <a class="direct-link" href="#create-the-client-side-code">#</a></h3>
<p>The final thing that needs to be done is to ensure that we can <a href="https://reactjs.org/docs/react-dom.html#hydrate">hydrate</a> our application on the client. Create an <code>index.js</code> file in the <code>src/client/</code> directory and add the following code:</p>
<p class="warn">
WARN: failing to hydrate the App on the client (and simply calling render) will result in React duplicating the efforts of your server. The hydrate function will attempt to work with the markup already provided.
</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"../app/App"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// bring the application to life!</span></span><br><span class="highlight-line">ReactDOM<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">,</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">client application launcher</p>
<p>That's it for the application!</p>
<h2 id="build-and-run-the-application">Build and run the application <a class="direct-link" href="#build-and-run-the-application">#</a></h2>
<p>Finally, let's add a script that we can use to run our Koa server. Update package.json with the following:</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line">…</span><br><span class="highlight-line"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"node ./src/server/index.js"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">...</span></code></pre>
<p class="caption">script to execute the server, but will it work?</p>
<p>Open your terminal, and from the project directory, run the following:</p>
<p><code class="term">npm run serve</code></p>
<p>Open a browser tab and navigate to <code>http://localhost:3000</code> to see… nothing, because your terminal is filled with errors. As stated earlier, my current version of node doesn't support ES modules, but that's what I've chosen to use throughout the application (which says nothing about the JSX our server is going to try to process in the render-react-app.js file). We need to do one last thing before everything is ready to go. Install the <code>@babel/register</code> package to help us with our current issue, namely, we need to run our server script through Babel in order for it to work in its current state. Run the following command in your terminal:</p>
<p class="warn">
WARN: as mentioned earlier, this setup works well for development purposes, but please don't adopt this practice for production. It would be better to run your application through Babel as part of a production build process and then run the server.
</p>
<p><code class="term">npm i @babel/register</code></p>
<p>Finally, put the package to use by creating an <code>index.js</code> file in the <code>project/</code> directory that will execute the package for the server:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"@babel/register"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span><br><span class="highlight-line">  presets<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"@babel/preset-env"</span><span class="token punctuation">,</span> <span class="token string">"@babel/preset-react"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  ignore<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules"</span><span class="token punctuation">]</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"./src/server/index.js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">script to run the server through babel on the fly</p>
<p>Update the package.json script:</p>
<pre class="language-json"><code class="language-json"><span class="highlight-line">...</span><br><span class="highlight-line"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">    <span class="token property">"serve"</span><span class="token operator">:</span> <span class="token string">"node index.js"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">...</span></code></pre>
<p class="caption">script to execute the server, should work now</p>
<p>One last time, return to your terminal, and try the <code>serve</code> script again:</p>
<p><code class="term">npm run serve</code></p>
<p>All should be well in the terminal window, so let's see what's being served to the client. Open or return to your browser tab and navigate to <code>http://localhost:3000</code>. Now, you can marvel at your application in action! If you open your browser's dev tools, you should be able to see the original source that was sent from the server (rendered App), but also note that the application has been hydrated and responds to the user interaction as expected (click the button!). That's it, an isomorphic JavaScript app in action... but, by no means is it production-ready.</p>
<h2 id="there%E2%80%99s-still-a-lot-more-that-we-could-explore">There’s still a lot more that we could explore <a class="direct-link" href="#there%E2%80%99s-still-a-lot-more-that-we-could-explore">#</a></h2>
<p>This exercise is instructive as to 'how' isomorphic JavaScript apps could be built, but it has by no means tackled any of the additional requirements a typical app needs in production. Heck, we’re only running the bundler and server in development mode! Additional topics to cover include (but are not limited to):</p>
<ul>
<li>serving static assets</li>
<li>component styling and stylesheets</li>
<li>shared application routing</li>
<li>cross-site request forgery</li>
<li>bundling for production</li>
<li>many other topics</li>
</ul>
<p>I may cover these additional topics, or prepare a series, in the near future if I can find the time. Stay tuned.</p>


<p class="top">
    <a href="#top">Top</a>
</p>
      </main>
      
      <footer class="page-footer">&copy; Nathan Humphrey</footer>

      <!-- Current page: /posts/2020-01-17-isomorphic-javascript-app/ -->
    </div>
  </body>
</html>