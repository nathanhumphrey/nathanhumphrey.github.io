<!doctype html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-50453547-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-50453547-1');
    </script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Full Stack JavaScript Application Build Part 1 - Routes and Pages</title>
    <meta name="Description" content="Part 1 of a series about how to build a full stack JavaScript application. This article is about routes and pages.">
    <link rel="icon" type="image/png" href="/favicon.ico?2108987463f3bdd37020efde9541db90">
    <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/index.css?e1fd7c362875933663374cdc5779b71d">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Nathan Humphrey">
  </head>
  <body>
    <div class="container" id="top">
      <header class="page-header">
        <p class="home">
          <a href="/">nh</a>
        </p>
        <nav class="page-nav">
          <h2 class="visually-hidden">Main Navigation Menu</h2>
          <ul class="nav"><li class="nav-item"><a href="/">Home</a></li>
<li class="nav-item"><a href="/posts/">Blog</a></li>
<li class="nav-item"><a href="/about/">About</a></li></ul>
        </nav>
      </header>

      <main class="tmpl-post" >
        <h1>Full Stack JavaScript Application Build Part 1 - Routes and Pages</h1>
<p class="meta time"><time datetime="2020-02-06T07:00:00.000Z">Thursday, February 6, 2020</time></p>
<p class="meta author">by Nathan Humphrey</p>
<p class="meta tags">

    <a href="/tags/software/" class="tag">software</a>
    <a href="/tags/tutorial/" class="tag">tutorial</a>
    <a href="/tags/javascript/" class="tag">javascript</a>
    <a href="/tags/fullstack/" class="tag">fullstack</a>
    <a href="/tags/koa/" class="tag">koa</a>
    <a href="/tags/react/" class="tag">react</a>
</p>
<p><em>Learning about what goes into building a full-stack JavaScript application can be a little daunting, but with some grit and perseverance, it can be a really rewarding experience. In this series, I'll be building a very simple isomorphic JavaScript application with some extra bells and whistles (e.g. routing, CSRF tokens, authentication, production bundling, etc.). If that all sounds interesting to you, then come along for the ride!</em></p>
<h2 id="introduction">Introduction <a class="direct-link" href="#introduction">#</a></h2>
<p>I've come across a lot of articles online about how to build a front-end application or how to build a back-end REST API, but rarely do I find articles dedicated to building out a full application (both front and back), no less an isomorphic JavaScript application. So, I've decided to write the series that I was always hoping to come across.</p>
<p><strong><em>The final project source can be found <a href="https://github.com/nathanhumphrey/simple-isomorphic-app/tree/routes">here</a></em></strong></p>
<h3 id="the-application">The Application <a class="direct-link" href="#the-application">#</a></h3>
<p>To keep things simple, the application we'll build won't do anything special, and by anything special I mean nothing. I've read through a lot of articles that try to teach basic, or even more advanced, concepts by building a complex application, which I find distracts from the core of what was being covered. I just want to focus on the chosen topic with as little <em>application</em> logic as necessary to explore the details of the topic. No more, and no less.</p>
<p>To that end, I plan on building an application that allows a user to sign up for an account, sign in and out of their account, and to view their account details (when signed in of course). That's it. With just these simple use cases, we can explore all the relevant bits that are required when creating a standard web application without getting lost in the details of the application logic. Effectively, when we're done, you'll have a boilerplate application setup that supports user accounts for whatever specific application you'd like to build next.</p>
<p>All that being said, there's nothing stopping you from making the build a little more exciting by adding additional pages, components, and logic if you feel so inclined. You may even decide to work through the series once, write down some 'what if' questions, and then come back around for another walkthrough while exploring the 'what ifs' you noted the first time. Do whatever will make this journey more fun for you.</p>
<h3 id="roadmap">Roadmap <a class="direct-link" href="#roadmap">#</a></h3>
<p>The build will be divided into a six-part series:</p>
<ol>
<li><a href="/posts/2020-02-06-full-stack-javascript-app-build-pt-1">Routes and pages</a> ⇐ you are here</li>
<li><s><a href="#">Building and styling components</a></s> (coming soon)</li>
<li><s><a href="#">Authenticating users</a></s> (coming soon)</li>
<li><s><a href="#">Protecting against CSRF</a></s> (coming soon)</li>
<li><s><a href="#">Production bundling</a></s> (coming soon)</li>
<li><s><a href="#">Deployment</a></s> (coming soon)</li>
</ol>
<p>I've also included some extra stretch goals as well (should the first six parts go smoothly):</p>
<ul>
<li>Cache busting</li>
<li>Code splitting</li>
<li>Progressive enhancement</li>
<li>Database integration</li>
<li>Testing</li>
</ul>
<p class="info">
NOTE: there are many articles published about how to implement most of the topics in the stretch goal list. Please feel free to use this project as a base for experimenting with other walkthroughs.
</p>
<p>Get started by working through my earlier <a href="/posts/2020-01-17-isomorphic-javascript-app/">Isomorphic JavaScript App</a> post first, which builds the foundation that will be used in this series. If you'd just like to get started with this series, you can download the starting code from GitHub <a href="https://github.com/nathanhumphrey/simple-isomorphic-app">here</a>.</p>
<h2 id="routes-and-pages">Routes and Pages <a class="direct-link" href="#routes-and-pages">#</a></h2>
<p>Our application will need to support the following use cases:</p>
<ul>
<li>Sign up for an account</li>
<li>Sign-in</li>
<li>Sign-out</li>
<li>View account details</li>
</ul>
<p>A page will be needed to support each of these use cases, and routes will need to be configured to support them as well. Sample flow through the application may look something like the following:</p>
<p>Home Page ⇒ Sign Up ⇒ Sign In ⇒ View Account ⇒ Sign Out</p>
<h3 id="endpoints">Endpoints <a class="direct-link" href="#endpoints">#</a></h3>
<p>Some of the actions noted above can be supported on a single page. I've chosen the following routes and pages for us to build on:</p>
<h4 id="index-route-%2F">Index route <code>/</code> <a class="direct-link" href="#index-route-%2F">#</a></h4>
<p>The index (or home) page can be used to provide a sign-in form (when not already signed in) and a sign-out link (when already signed) for the user.</p>
<h4 id="sign-up-route-%2Fsignup">Sign up route <code>/signup</code> <a class="direct-link" href="#sign-up-route-%2Fsignup">#</a></h4>
<p>The signup page will present a basic form for gathering account details (name, email, password, etc.) from the user.</p>
<h4 id="view-account-route-%2Fusers%2F%3Aid">View account route <code>/users/:id</code> <a class="direct-link" href="#view-account-route-%2Fusers%2F%3Aid">#</a></h4>
<p>The user page will present the currently signed in user's details. Don't mind the <code>:id</code> in the route, it simply represents a variable paramter that would be included in the URL (e.g. /users/1 or /users/jdoe).</p>
<h3 id="implementation">Implementation <a class="direct-link" href="#implementation">#</a></h3>
<p>The implementation of pages and routes, as we've identified them, requires that they work both on the client and the server. Every attempt will be made to reduce duplication (as much as is possible) while at the same time retaining good maintainability; changing or adding a page shouldn't require a cascade of changes throughout the application.</p>
<p>Since the routes are at the heart of this application, we should utilize a shared <code>routes.js</code> file that can be used to define routes everywhere we need them. The routes can be imported and then implemented for the server and for our React application. When a new page is added, we can simply define the route in our routes file.</p>
<h4 id="routes">Routes <a class="direct-link" href="#routes">#</a></h4>
<p>Initially, our application will need to know a few things about each route:</p>
<ul>
<li>the path (URL path to match)</li>
<li>the HTTP method (HTTP verb to accept)</li>
<li>the route name (unique name to identify the route)</li>
</ul>
<p>Finally, time to code! Since the routes are shared by both the server and client, we will create the <code>routes.js</code> file in the <code>src/app/</code> directory. Once created, open the file and export an array of routes:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"home"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"/signup"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"signup"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"/users/:id"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"userdetails"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"nomatch"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">routes for the application - src/app/routes.js</p>
<p class="info">
NOTE: I've also included a <i>nomatch</i> route, for any non-matched paths.
</p>
<p>The array of routes in <code>routes.js</code> can now be imported into our <code>src/server/index.js</code> and used to direct requests, as well as in <code>App.js</code> to direct requests on the client. To make it easier for us to complete these two tasks, we'll make use of available packages: <a href="https://github.com/ZijianHe/koa-router">koa-router</a> for the server and <a href="https://reacttraining.com/react-router/web/guides/quick-start">react-router-dom</a> for the client.</p>
<p>Install the required packages:</p>
<p><code class="term">npm i koa-router react-router-dom</code></p>
<p>Now that we've installed the requirements, let's put them to use.</p>
<h5 id="server-routes">Server Routes <a class="direct-link" href="#server-routes">#</a></h5>
<p>Using koa-router is fairly straight-forward. First, we start by creating a new <code>Router</code> object and then assign routes and handlers as necessary. Defining routes can be done with HTTP verb specific method calls or by calling the <code>use()</code> method; I've chosen to use the verb method route (pun intended) and will leave the exploration of the <code>use()</code> method to you.</p>
<p>As a quick example, adding the route for our index page may look something like the following:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">"koa-router"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">"requested the index route"</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">exmple using koa-router</p>
<p>In the example above, only get requests for the <code>/</code> path will be matched by the router. In response, the body of the context, which will be returned to the client, simply contains a string message to display. Let's implement this basic example before applying the routes we defined above.</p>
<p>Open and update <code>src/server/index.js</code> as follows:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token operator">...</span></span><br><span class="highlight-line"></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'koa-router'</span><span class="token punctuation">;</span> <span class="token comment">// server-side routing</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create the app server</span></span><br><span class="highlight-line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// prepare webpack compiler</span></span><br><span class="highlight-line"><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><mark class="highlight-line highlight-line-active"><span class="token comment">// create the app router</span></mark><br><mark class="highlight-line highlight-line-active"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active"></mark><br><mark class="highlight-line highlight-line-active"><span class="token comment">// define route(s)</span></mark><br><mark class="highlight-line highlight-line-active">router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></mark><br><mark class="highlight-line highlight-line-active">  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">'requested the index route'</span><span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create koa webpack middleware</span></span><br><span class="highlight-line"><span class="token function">koaWebpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span> compiler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">middleware</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// use the koa middleware</span></span><br><mark class="highlight-line highlight-line-active">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active">  <span class="token comment">// removed the renderReactApp middleware, use router going forward</span></mark><br><mark class="highlight-line highlight-line-active">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">...</span></span><br><span class="highlight-line"></span></code></pre>
<p class="caption">update server/index.js to support example route - src/server/index.js</p>
<p>Now, run the <code>serve</code> script and navigate to <a href="http://localhost:3000/">http://localhost:3000/</a> in your browser. You should see the message we assigned to <code>ctx.body</code> displayed in the browser. And now we have a server-side router!</p>
<p><code class="term">npm run serve</code></p>
<p class="info">NOTE: only matched routes will be returned. If you navigate to a path that hasn't been defined as a route, you will receive a 404 not found response.</p>
<aside>
<p>
    TIP: To make development a little easier, let's make a quick update to start the application using <a href="https://nodemon.io/">nodemon</a>. Install the `nodemon` package
</p>
<p><code class="term">npm i -D nodemon</code></p>
<p>
    then update the serve script in package.json:
</p>
<pre class="language-json">
<span class="highlight-line">...</span>
<span class="highlight-line highlight-line-active">"serve": "nodemon index.js"</span>
<span class="highlight-line">...</span>
</pre>
<p class="caption">update serve script - package.json</p>
<p>
Now, changes to the server code will be automatically reloaded and we won't have to stop and start the process whenever we make some changes. To see a more detailed setup using webpack and webpack DevServer, see this <a href="/posts/2019-12-21-simple-webpack-setup/#development-server">post</a>.
</p>
</aside>
<p>Let's update the code to work with our defined routes. We can simply iterate over all routes in the array and apply a route to our koa-router for each one. Make the following updates to <code>src/server/index.js</code>:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token operator">...</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">import</span> Router <span class="token keyword">from</span> <span class="token string">'koa-router'</span><span class="token punctuation">;</span> <span class="token comment">// server-side routing</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token punctuation">{</span> routes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../app/routes'</span><span class="token punctuation">;</span> <span class="token comment">// defined application routes</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create the app server</span></span><br><span class="highlight-line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// prepare webpack compiler</span></span><br><span class="highlight-line"><span class="token keyword">const</span> compiler <span class="token operator">=</span> <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create the app router</span></span><br><span class="highlight-line"><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// define route(s)</span></span><br><mark class="highlight-line highlight-line-active">routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token punctuation">{</span></mark><br><mark class="highlight-line highlight-line-active">  router<span class="token punctuation">[</span>route<span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></mark><br><mark class="highlight-line highlight-line-active">    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> route<span class="token punctuation">.</span>name<span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><mark class="highlight-line highlight-line-active"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create koa webpack middleware</span></span><br><span class="highlight-line"><span class="token function">koaWebpack</span><span class="token punctuation">(</span><span class="token punctuation">{</span> compiler <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">middleware</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token comment">// use the koa middleware</span></span><br><span class="highlight-line">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line">  <span class="token comment">// removed the renderReactApp middleware, use router going forward</span></span><br><span class="highlight-line">  app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">...</span></span><br><span class="highlight-line"></span></code></pre>
<p class="caption">update server/index.js to implement defined routes - src/server/index.js</p>
<p class="info">
NOTE: There is a lot of versatility in the way in which we've implemented our routes. Looking to the future, we can easily extend the route objects in `routes.js` to define whether they require authentication, should be included in page navigation, require initial data, and so on.
</p>
<p>The current handler for each route is just an arrow function, for the moment. What we really want is for our routes to be rendered by our react render middleware. Update the <code>src/server/index.js</code> one final time before we move on to defining pages:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token operator">...</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// define route(s)</span></span><br><span class="highlight-line">routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><mark class="highlight-line highlight-line-active">  router<span class="token punctuation">[</span>route<span class="token punctuation">.</span>method<span class="token punctuation">]</span><span class="token punctuation">(</span>route<span class="token punctuation">.</span>path<span class="token punctuation">,</span> renderReactApp<span class="token punctuation">)</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token operator">...</span></span><br><span class="highlight-line"></span></code></pre>
<p class="caption">use react renderer for all defined routes - src/server/index.js</p>
<p>The problem now is that all the routes end up getting rendered as the default app (currently a sample clicker app). We need to define a few things for our application to render correctly: separate pages for each route and a client-side router that knows which page to render based on the current route.</p>
<h4 id="pages">Pages <a class="direct-link" href="#pages">#</a></h4>
<p>Let's begin by defining a <code>Page</code> component that can be reused for all pages we'd like to render for the client.</p>
<p>Create a <code>components</code> directory under <code>src/app/</code> and then create a new file, <code>Page.js</code>, in the components directory. Open <code>Page.js</code> and insert the following code:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">Page</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>div className<span class="token operator">=</span><span class="token string">"page-container"</span><span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>main<span class="token operator">></span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>main<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> Page<span class="token punctuation">;</span></span></code></pre>
<p class="caption">Page component - src/app/components/Page.js</p>
<p>This component is pretty plain at the moment. It simply provides exactly what the name implies, a page that we can extend for our application. Any children defined within the Page component will simply be rendered. Let's put it into action by creating our first page.</p>
<p>Create a <code>pages</code> directory under <code>src/app/</code> and then create a new file, <code>home.js</code>, in the pages directory. Open <code>home.js</code> and insert the following code:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> Page <span class="token keyword">from</span> <span class="token string">"../components/Page"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">HomePage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>Page<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>h1<span class="token operator">></span>Home Page<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>p<span class="token operator">></span>Home page content will appear here<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Page<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> HomePage<span class="token punctuation">;</span></span></code></pre>
<p class="caption">Home page component - src/app/pages/home.js</p>
<p>Okay, we have a single page that we can use for testing purposes. Open <code>src/app/App.js</code> and let's make some updates to support routing and our new home page. Remove all existing code in the <code>App</code> function and add the following:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> HomePage <span class="token keyword">from</span> <span class="token string">"./pages/home"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><mark class="highlight-line highlight-line-active">  <span class="token keyword">return</span> <span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span></code></pre>
<p class="caption">Home page rendered from App - src/app/App.js</p>
<p>Now all routes will result in the home page being rendered, progress. Let's add the required routing pieces for the App.</p>
<p class="info">
NOTE: the remaining two pages will be defined essentially the same way as this home page (i.e. simply rendering a message of some kind). See if you can create the two remaining pages on your own; the final repo will have all three pages completed for you to review.
</p>
<h4 id="app-routes">App routes <a class="direct-link" href="#app-routes">#</a></h4>
<p>The <code>App</code> component is being shared by both the server and client, which means we need to address routing for both cases. This can be achieved by defining the routes themselves within the <code>App</code> component and then encapsulating the <code>App</code> routes with the proper router provider, so to speak. The <code>react-router-dom</code> package provides a means to achieve our goals.</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token keyword">import</span> Home <span class="token keyword">from</span> <span class="token string">"./pages/home"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><mark class="highlight-line highlight-line-active">  <span class="token keyword">return</span> <span class="token punctuation">(</span></mark><br><mark class="highlight-line highlight-line-active">    <span class="token operator">&lt;</span>Switch<span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">      <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">        <span class="token operator">&lt;</span>Home <span class="token operator">/</span><span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">      <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span></mark><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span></code></pre>
<p class="caption">App updated to support routing - src/app/App.js</p>
<p>Now our App implements a Switch, that will only render one route. The Switch component will render the first Route that matches the path provided. This is only the first step we need to make to get this App routing working. Now, we need to implement the server-side router and the client-side router.</p>
<h5 id="server-side-app-routes">Server-side App routes <a class="direct-link" href="#server-side-app-routes">#</a></h5>
<p>Server-side rendering of our application is being done in the <code>src/server/render-react-app.js</code> file; open the file and make the following udpates:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-dom/server"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token punctuation">{</span> StaticRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"../app/App"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">const</span> staticContext <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// used to store info about the render</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token parameter">ctx</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">const</span> renderComponent <span class="token operator">=</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>html<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>head<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>title<span class="token operator">></span>Isomorphic React App<span class="token operator">&lt;</span><span class="token operator">/</span>title<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"index.js"</span> defer <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>head<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>body<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"app"</span><span class="token operator">></span></span><br><mark class="highlight-line highlight-line-active">          <span class="token operator">&lt;</span>StaticRouter location<span class="token operator">=</span><span class="token punctuation">{</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">}</span> context<span class="token operator">=</span><span class="token punctuation">{</span>staticContext<span class="token punctuation">}</span><span class="token operator">></span></mark><br><span class="highlight-line">            <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span></span><br><mark class="highlight-line highlight-line-active">          <span class="token operator">&lt;</span><span class="token operator">/</span>StaticRouter<span class="token operator">></span></mark><br><span class="highlight-line">        <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>html<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line">  ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">renderToString</span><span class="token punctuation">(</span>renderComponent<span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">Server-side render updated to support routing - src/server/render-react-app.js</p>
<p>The server will now only render matched paths within the <code>StaticRouter</code>. Later, we'll update with our own version of a 404 page for any unmatched paths.</p>
<h5 id="client-side-app-routes">Client-side App routes <a class="direct-link" href="#client-side-app-routes">#</a></h5>
<p>In much the same way we implemented a router for the server-side render of our app, we must do the same for the client. Open the <code>src/client/index.js</code> file and make the following updates:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> ReactDOM <span class="token keyword">from</span> <span class="token string">"react-dom"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token punctuation">{</span> BrowserRouter <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"../app/App"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><mark class="highlight-line highlight-line-active">ReactDOM<span class="token punctuation">.</span><span class="token function">hydrate</span><span class="token punctuation">(</span></mark><br><mark class="highlight-line highlight-line-active">  <span class="token operator">&lt;</span>BrowserRouter<span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">    <span class="token operator">&lt;</span>App <span class="token operator">/</span><span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">  <span class="token operator">&lt;</span><span class="token operator">/</span>BrowserRouter<span class="token operator">></span><span class="token punctuation">,</span></mark><br><mark class="highlight-line highlight-line-active">  document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"app"</span><span class="token punctuation">)</span></mark><br><span class="highlight-line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">client-side routing support added - src/client/index.js</p>
<p>That's it! All routing is setup and should be working. Now, when you run the server and navigate to the index route, you should see the home page content. But, when you navigate to the another supported but not implemented route, you will see ... nothing. That's because we haven't defined routes (or pages at this point) for our remaining pages. Let's create a <code>NoMatchPage</code> page we can render when no known paths are matched by the router.</p>
<p>Create a new file under <code>src/app/pages</code> named <code>no-match.js</code> and insert the following code:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> Page <span class="token keyword">from</span> <span class="token string">"../components/Page"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">NoMatchPage</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>Page<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>h1<span class="token operator">></span>Sorry<span class="token operator">!</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>p<span class="token operator">></span>The page you<span class="token string">'re looking for can'</span>t be found<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Page<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> NoMatchPage<span class="token punctuation">;</span></span></code></pre>
<p class="caption">NoMatchPage added for unmatched routes - src/app/pages/no-match.js</p>
<p>We can now add this new page under a no match route in our <code>App</code>. Open and edit the <code>src/app/App.js</code> file as follows:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> HomePage <span class="token keyword">from</span> <span class="token string">"./pages/home"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> NoMatchPage <span class="token keyword">from</span> <span class="token string">"./pages/no-match"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>Switch<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span>Route exact path<span class="token operator">=</span><span class="token string">"/"</span><span class="token operator">></span></span><br><span class="highlight-line">        <span class="token operator">&lt;</span>HomePage <span class="token operator">/</span><span class="token operator">></span></span><br><span class="highlight-line">      <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span></span><br><mark class="highlight-line highlight-line-active">      <span class="token operator">&lt;</span>Route path<span class="token operator">=</span><span class="token string">"*"</span><span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">        <span class="token operator">&lt;</span>NoMatchPage <span class="token operator">/</span><span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">      <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span></mark><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span></code></pre>
<p class="caption">NoMatchPage added for unmatched routes - src/app/pages/no-match.js</p>
<p>With this addition, if you navigate to <a href="http://localhost:3000/signup">http://localhost:3000/signup</a>, you should no longer see a blank screen but instead see our new no match page.</p>
<h3 id="upgrading-route-declarations">Upgrading Route Declarations <a class="direct-link" href="#upgrading-route-declarations">#</a></h3>
<p>We can use our <code>routes.js</code> file to define the application routes in much the same way we used it for the server. Import the <code>routes.js</code> file into <code>App.js</code>, iterate over the routes and create a Route component for each one. Open <code>src/app/App.js</code> and make the following updates:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> HomePage <span class="token keyword">from</span> <span class="token string">"./pages/home"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token punctuation">{</span> routes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./routes"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><mark class="highlight-line highlight-line-active">    <span class="token operator">&lt;</span>Switch<span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">      <span class="token punctuation">{</span>routes<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token punctuation">(</span></mark><br><mark class="highlight-line highlight-line-active">        <span class="token operator">&lt;</span>Route key<span class="token operator">=</span><span class="token punctuation">{</span>route<span class="token punctuation">.</span>page<span class="token punctuation">}</span> path<span class="token operator">=</span><span class="token punctuation">{</span>route<span class="token punctuation">.</span>path<span class="token punctuation">}</span><span class="token operator">></span></mark><br>          <span class="token punctuation">{</span><span class="token comment">/* <br><mark class="highlight-line highlight-line-active">            but what do we put in here now? Can't all be HomePage</mark><br><mark class="highlight-line highlight-line-active">            or NoMatchPage!</mark><br>          */</span><span class="token punctuation">}</span><br><span class="highlight-line">        <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span></span><br><span class="highlight-line">      <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span></code></pre>
<p class="caption">update App.js to make use of defined routes - src/app/App.js</p>
<p>This looks a lot cleaner but, as the embedded comment above states, how do we know what page to render? And what about exact path matches (as it is now, everything will match the first index route)?</p>
<p>Well, we simply add requirements to the route objects! We can extend the routes, as noted earlier, to support whatever we need them to do for us. In this case, let's simply update with an optional <code>exact</code> match boolean property, and an optional <code>pageName</code> property that indicates which page to use for the route. Update <code>src/app/routes.js</code> as follows:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">const</span> routes <span class="token operator">=</span> <span class="token punctuation">[</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"/"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"home"</span><span class="token punctuation">,</span></span><br><mark class="highlight-line highlight-line-active">    page<span class="token operator">:</span> <span class="token string">"HomePage"</span><span class="token punctuation">,</span></mark><br><mark class="highlight-line highlight-line-active">    exact<span class="token operator">:</span> <span class="token boolean">true</span></mark><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"/signup"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"signup"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"/users/:id"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"userdetails"</span></span><br><span class="highlight-line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span><br><span class="highlight-line">  <span class="token punctuation">{</span></span><br><span class="highlight-line">    path<span class="token operator">:</span> <span class="token string">"*"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span></span><br><span class="highlight-line">    name<span class="token operator">:</span> <span class="token string">"nomatch"</span><span class="token punctuation">,</span></span><br><mark class="highlight-line highlight-line-active">    page<span class="token operator">:</span> <span class="token string">"NoMatchPage"</span></mark><br><span class="highlight-line">  <span class="token punctuation">}</span></span><br><span class="highlight-line"><span class="token punctuation">]</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">update routes to support pages and exact path matches - src/app/routes.js</p>
<p>The second thing we'll need to do now is to export all our known pages so they too can be easily accessed from one location. Create an <code>index.js</code> in <code>src/app/pages</code> and insert the following:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> HomePage <span class="token keyword">from</span> <span class="token string">"./home"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> NoMatchPage <span class="token keyword">from</span> <span class="token string">"./no-match"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token comment">// create 'collection' of pages</span></span><br><span class="highlight-line"><span class="token keyword">const</span> pages <span class="token operator">=</span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  HomePage<span class="token operator">:</span> HomePage<span class="token punctuation">,</span></span><br><span class="highlight-line">  NoMatchPage<span class="token operator">:</span> NoMatchPage</span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token punctuation">{</span> pages <span class="token punctuation">}</span><span class="token punctuation">;</span></span></code></pre>
<p class="caption">single access for all application pages - src/app/pages/index.js</p>
<p class="warn">
WARN: the approach taken here will require that you match your page names in <code>src/app/pages/index.js</code> to the names used in <code>src/app/routes.js</code> or they won't match for creating <code>Routes</code>.
</p>
<p>Once this has been completed, import the <code>pages</code> object, and we can then filter relevant routes for display in our app by the <code>page</code> property and include an <code>exact</code> prop for our routes as well. Update <code>App.js</code>:</p>
<pre class="language-js"><code class="language-js"><span class="highlight-line"><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">"react"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> Route<span class="token punctuation">,</span> Switch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"react-router-dom"</span><span class="token punctuation">;</span></span><br><mark class="highlight-line highlight-line-active"><span class="token keyword">import</span> <span class="token punctuation">{</span> pages <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./pages/"</span><span class="token punctuation">;</span></mark><br><span class="highlight-line"><span class="token keyword">import</span> <span class="token punctuation">{</span> routes <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"./routes"</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">const</span> <span class="token function-variable function">App</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{</span></span><br><span class="highlight-line">  <span class="token keyword">return</span> <span class="token punctuation">(</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span>Switch<span class="token operator">></span></span><br><mark class="highlight-line highlight-line-active">      <span class="token punctuation">{</span>routes</mark><br><mark class="highlight-line highlight-line-active">        <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> route<span class="token punctuation">.</span>page<span class="token punctuation">)</span></mark><br><mark class="highlight-line highlight-line-active">        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">route</span> <span class="token operator">=></span> <span class="token punctuation">(</span></mark><br><mark class="highlight-line highlight-line-active">          <span class="token operator">&lt;</span>Route exact<span class="token operator">=</span><span class="token punctuation">{</span>route<span class="token punctuation">.</span>exact<span class="token punctuation">}</span> key<span class="token operator">=</span><span class="token punctuation">{</span>route<span class="token punctuation">.</span>page<span class="token punctuation">}</span> path<span class="token operator">=</span><span class="token punctuation">{</span>route<span class="token punctuation">.</span>path<span class="token punctuation">}</span><span class="token operator">></span></mark><br><mark class="highlight-line highlight-line-active">            <span class="token punctuation">{</span>pages<span class="token punctuation">[</span>route<span class="token punctuation">.</span>page<span class="token punctuation">]</span><span class="token punctuation">}</span></mark><br><span class="highlight-line">          <span class="token operator">&lt;</span><span class="token operator">/</span>Route<span class="token operator">></span></span><br><span class="highlight-line">        <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><br><span class="highlight-line">    <span class="token operator">&lt;</span><span class="token operator">/</span>Switch<span class="token operator">></span></span><br><span class="highlight-line">  <span class="token punctuation">)</span><span class="token punctuation">;</span></span><br><span class="highlight-line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span><br><span class="highlight-line"></span><br><span class="highlight-line"><span class="token keyword">export</span> <span class="token keyword">default</span> App<span class="token punctuation">;</span></span></code></pre>
<p class="caption">update routes to support pages and exact path matches - src/app/routes.js</p>
<p>Now our app router will only render routes that have pages, and it will also match exact paths when required.</p>
<h3 id="wrap-up">Wrap-Up <a class="direct-link" href="#wrap-up">#</a></h3>
<p>That's quite a lot to digest for one post. Let's look back and recap what we've done:</p>
<ul>
<li>Identified required routes for the application</li>
<li>Implemented server route handling</li>
<li>Created necessary pages for rendering the application</li>
<li>Implemented server-side and client-side application routing</li>
</ul>
<p>I want to encourage you to review the code and concepts we've covered in this post, and to experiment with potential alternatives for getting everything we've built come together. I've left the implementation of the two remaining pages (user.js and signup.js) as an exercise for you, the reader. I'll include all pages in the final version of this part of the series in the repo, which you can access <a href="https://github.com/nathanhumphrey/simple-isomorphic-app/tree/routes">here</a>.</p>
<h3 id="up-next">Up Next <a class="direct-link" href="#up-next">#</a></h3>
<p>In the next part of this series (coming soon), we'll build and style the necessary user interface components for this project. Specifically, We'll build a Nav component with links for navigating around the site as well as some components for viewing the user account details. A very simple user model will also be introduced to help us test our app. I hope you'll continue to join me on this learning journey.</p>


<p class="top">
    <a href="#top">Top</a>
</p>
      </main>
      
      <footer class="page-footer">&copy; Nathan Humphrey</footer>

      <!-- Current page: /posts/2020-02-06-full-stack-javascript-app-build-pt-1/ -->
    </div>
  </body>
</html>